# Machine

## BOM

| 分類 | 名称 | 個数 | 概算コスト(円) | 説明 |
| ---- | ---- | ---- | ---- | ---- |
| コンピュータ | [ラズパイ3B+](https://www.raspberrypi.com/products/raspberry-pi-3-model-b-plus/) |1| ---- |　販売終了 |
| コンピュータ | [ラズパイ3A](https://raspberry-pi.ksyic.com/main/index/pdp.id/512/pdp.open/512) |-| 5000 |（代替）|
| コンピュータ | [ラズパイ4B](https://akizukidenshi.com/catalog/g/g114839/) |-| 10000 |（代替）|
| SDカード | 配布時期による | 1 | ---- | 64GB以上、書き込み速度30MB/s以上推奨 |
| 距離センサ | [超音波距離センサー HC-SR04](https://akizukidenshi.com/catalog/g/g111009/) | 5 | 1500 | [データシート](https://akizukidenshi.com/goodsaffix/hc-sr04_v20.pdf) |
| ジャイロ加速度センサ | [BNO055使用 9軸センサーフュージョンモジュールキット](https://akizukidenshi.com/catalog/g/g116996/) |任意| 2500 | [データシート](https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bno055-ds000.pdf) |
| カメラ | [ラズベリー•パイ（Raspberry Pi）160°広角500MP](https://jp.sainsmart.com/products/wide-angle-fov160-5-megapixel-camera-module-for-raspberry-pi) |任意| 3000 |　コース内特徴を捉えるため、広角推奨。 |
| シャーシ | [RCスターユニット 1/14 エアロ アバンテ](https://tamiyashop.jp/shop/g/g57402/) | 1 | 6500 |　販売終了 |
| モーター | シャーシに含む | 1 | ---- | |
| コンピュータ用バッテリ | [Anker PowerCore Fusion 5000](https://amzn.asia/d/b78Zim4) | 1 | 3600 | |
| 駆動用バッテリ | 単３電池 | 4 | 400 | |
| モータドライバ | [RC ESC 20A ブラシモーター](https://www.amazon.co.jp/GoolRC-%E3%83%96%E3%83%A9%E3%82%B7%E3%83%A2%E3%83%BC%E3%82%BF%E3%83%BC-%E3%82%B9%E3%83%94%E3%83%BC%E3%83%89%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC-%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E5%8F%AF%E8%83%BD-%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AD%E4%BB%98/dp/B014RB6WS6) |1| 1500 | |
| サーボドライバ | [PCA9685 16チャンネル 12-ビット PWM Servo モーター ドライバー](https://amzn.asia/d/0sswysQ) | 1 | 1000 | |
| コントローラー | [Logicool G ゲームパッド コントローラー F710](https://www.amazon.co.jp/%E3%83%AD%E3%82%B8%E3%82%AF%E3%83%BC%E3%83%AB-F710r-%E3%80%90%E3%83%A2%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%8F%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%83%AD%E3%83%B3%E3%83%86%E3%82%A3%E3%82%A2%E6%AD%A3%E5%BC%8F%E6%8E%A8%E5%A5%A8%E3%80%91-LOGICOOL-%E3%83%AF%E3%82%A4%E3%83%A4%E3%83%AC%E3%82%B9%E3%82%B2%E3%83%BC%E3%83%A0%E3%83%91%E3%83%83%E3%83%89/dp/B00CDG7994) | 1 | 4000 | |
| 締結部品 | [2mm六角スペーサ](https://www.amazon.co.jp/%E3%83%8A%E3%82%A4%E3%83%AD%E3%83%B3%E3%83%8D%E3%82%B8%E3%83%8A%E3%83%83%E3%83%88-320%E5%80%8B%E3%82%BB%E3%83%83%E3%83%88-%E5%85%AD%E8%A7%92%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B5%E3%83%BC-%E3%82%B9%E3%82%BF%E3%83%B3%E3%83%89%E3%82%AA%E3%83%95-%E5%8F%8E%E7%B4%8D%E3%82%B1%E3%83%BC%E3%82%B9%E4%BB%98%E3%81%8D/dp/B09G9RPC18/ref=sr_1_34_sspa?dib=eyJ2IjoiMSJ9.v2Z5JMko630Hc7v-Db1vOLYgTcYCkoMUhfz5IF_I-4JzqykRRxcumS9lJH4CKRcZ15qY-ViSoY3mtOiVZ0QP2wZkjw5S2E_UsbHvFKbaAgUxhOZUDZnY04JrS-doS5FGCc5ihOEbmM6H6voaFzNCjI46_wAnwlSwjeBHu8YuoFJTpUrYDTPbYk2T87zNKMDjfvW7avb-M0O-T4HuXnUi2xE98TZeNuB1jUJXaeh3tX3x7mQEx-yJYUpk9ZUcs2HSCpgzlfMUIAT36_JyIaXNXcYC9brXbkFmLpu3ATNf_Po.wq0WsIwMoUsaMbQw_f9EKbe3EONGyw4YZiOi3AQ8UR8&dib_tag=se&keywords=6%E8%A7%92%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B5%E3%83%BC+2mm&qid=1713080306&sr=8-34-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9tdGY&psc=1) |16|1000 |ラズパイマウント用 |
| 締結部品 | 2mm六角スペーサ |6| ↑|サーボドライバ用 |
| マウント | ラズパイ/バッテリマウント |1|1000 | 材料費のみ換算 |
| マウント | カメラマウント |1| 300| 材料費のみ換算 |
| マウント | 超音波センサマウント |1| 500| 材料費のみ換算 |
| ケーブル | ジャンパワイヤ　メス-オス |5| 1000| 超音波センサ用 |
| ケーブル | ジャンパワイヤ　メス-メス |1| 1000| サーボドライバ用 |
| togikai基盤 | サーボドライバ代替 |任意| --- |  HC-SR04*8個接続用ジャンパピン・ PCA9685 2ch・OLED・ファン電源搭載、秋月BNO055モジュール追加搭載用I2Cスルーホール有 |

## Raspberry Pi

cf. [ラズベリーパイの環境チェック いろいろ](https://wisteriahill.sakura.ne.jp/CMS/WordPress/2018/09/06/check-raspbian/#OS)

### Hardware model

```bash
$ cat /proc/device-tree/model
Raspberry Pi 3 Model B Plus Rev 1.3
```

### Pin

Install the following packages:

```bash
sudo apt-get update
sudo apt-get install python3-gpiozero
```

Run the following command:

```bash
$  pinout
,--------------------------------.
| oooooooooooooooooooo J8     +====
| 1ooooooooooooooooooo  PoE   | USB
|  Wi                    1o   +====
|  Fi  Pi Model 3B+ V1.3 oo      |
|        ,----.               +====
| |D|    |SoC |               | USB
| |S|    |    |               +====
| |I|    `----'                  |
|                   |C|     +======
|                   |S|     |   Net
| pwr        |HDMI| |I||A|  +======
`-| |--------|    |----|V|-------'

Revision           : a020d3
SoC                : BCM2837
RAM                : 1GB
Storage            : MicroSD
USB ports          : 4 (of which 0 USB3)
Ethernet ports     : 1 (300Mbps max. speed)
Wi-fi              : True
Bluetooth          : True
Camera ports (CSI) : 1
Display ports (DSI): 1

J8:
   3V3  (1) (2)  5V
 GPIO2  (3) (4)  5V
 GPIO3  (5) (6)  GND
 GPIO4  (7) (8)  GPIO14
   GND  (9) (10) GPIO15
GPIO17 (11) (12) GPIO18
GPIO27 (13) (14) GND
GPIO22 (15) (16) GPIO23
   3V3 (17) (18) GPIO24
GPIO10 (19) (20) GND
 GPIO9 (21) (22) GPIO25
GPIO11 (23) (24) GPIO8
   GND (25) (26) GPIO7
 GPIO0 (27) (28) GPIO1
 GPIO5 (29) (30) GND
 GPIO6 (31) (32) GPIO12
GPIO13 (33) (34) GND
GPIO19 (35) (36) GPIO16
GPIO26 (37) (38) GPIO20
   GND (39) (40) GPIO21

POE:
TR01 (1) (2) TR00
TR03 (3) (4) TR02

For further information, please refer to https://pinout.xyz/
```

### OS

```bash
$ lsb_release -a
No LSB modules are available.
Distributor ID: Raspbian
Description:    Raspbian GNU/Linux 10 (buster)
Release:        10
Codename:       buster
```

```bash
$ cat /etc/os-release
PRETTY_NAME="Raspbian GNU/Linux 10 (buster)"
NAME="Raspbian GNU/Linux"
VERSION_ID="10"
VERSION="10 (buster)"
VERSION_CODENAME=buster
ID=raspbian
ID_LIKE=debian
HOME_URL="http://www.raspbian.org/"
SUPPORT_URL="http://www.raspbian.org/RaspbianForums"
BUG_REPORT_URL="http://www.raspbian.org/RaspbianBugs"
```

### Kernel

```bash
$ uname -a
Linux togikai34 5.10.103-v7+ #1529 SMP Tue Mar 8 12:21:37 GMT 2022 armv7l GNU/Linux
```

### CPU

デフォルトの設定、または/boot/config.txtで指定された値を取得。

```bash
$ vcgencmd get_config arm_freq
arm_freq=1400
# 1.4GHz
```

実際の周波数を取得。

```bash
$ vcgencmd measure_clock arm
frequency(48)=700074000
# 700.074MHz
```

負荷の高い処理の場合、クロック数は上昇し、設定最高温度に近づくと低下するようです。

Core:

```bash
$ nproc
4
```

CPU情報 動作周波数を取得

```bash
$ cpufreq-info -o
          minimum CPU frequency  -  maximum CPU frequency  -  governor
CPU  0      1400000 kHz (100 %)  -    1400000 kHz (100 %)  -  ondemand
CPU  1      1400000 kHz (100 %)  -    1400000 kHz (100 %)  -  ondemand
CPU  2      1400000 kHz (100 %)  -    1400000 kHz (100 %)  -  ondemand
CPU  3      1400000 kHz (100 %)  -    1400000 kHz (100 %)  -  ondemand
```

リアルタイムで動作クロックを確認

```bash
Every 2.0s: vcgencmd measure_clock arm                             togikai34: Wed Aug 14 22:51:23 2024

frequency(48)=1400000000
```

### Internal Temperature

CPU

```bash
$ cat /sys/class/thermal/thermal_zone0/temp
52078
# 52.078 degree
```

### Disk space usage

```bash
$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root        29G  6.1G   23G  22% /
devtmpfs        404M     0  404M   0% /dev
tmpfs           436M     0  436M   0% /dev/shm
tmpfs           436M  6.0M  430M   2% /run
tmpfs           5.0M  4.0K  5.0M   1% /run/lock
tmpfs           436M     0  436M   0% /sys/fs/cgroup
/dev/mmcblk0p1  253M   50M  203M  20% /boot
tmpfs            88M   16K   88M   1% /run/user/1000
```

### Swap

swapが頻発するとNAND型のMicroSDは寿命が縮むという話があるらしい。

32GBくらいあれば、エンデュランス・リテンションの両方でそんなに心配する必要ないみたいです。MicroSDの寿命の前にラズパイの賞味期限が切れるような気がする。心配ならデータのバックアップしときましょう。更に、そんなに高いもんじゃないんだからラズパイ自体のクローンを作っておくという手もあるかもしれません。

```bash
$ free
              total        used        free      shared  buff/cache   available
Mem:         892584      176164      195308        6988      521112      654904
Swap:        102396           0      102396
```

cf. [【ITエンジニアの豆知識】メモリの SWAP、ホントに理解してる…？](https://beyondjapan.com/blog/2022/01/mame_swap/)

### Display Resolution

- Default 720x480
- Updated: DMT mode 82 1920x1080 60Hz 16:9

## shell

```bash
$ echo $SHELL
/bin/bash
```

Create ~/.bashrc and ~/.bash_aliases.

## git

```bash
$ git --version
git version 2.20.1
```

## Python

Default: Python 3.7.3

```bash
$ python -V
Python 3.7.3
```

Python2

```bash
$ python2 -V
Python 2.7.16
```

Python3

```bash
$ python3 -V
Python 3.7.3
```

## Default Projects

```bash
$ tree ~/projects/ -L 1
/home/pi/projects/
├── bno055-python-i2c
├── donkeycar
├── mycar
├── pytorch-armv7l-main
└── togikaidrive
```

Two main projects are available.

1. togikaiaidrive
2. donkeycar
   - mycar
   - donkeycar

### Donkey car

```bash
$ tree ~/mycar/
/home/pi/mycar/
├── calibrate.py
├── config.py
├── data
├── logs
├── manage.py
├── models
├── myconfig.py
└── train.py
```

| File name    | Description |
|--------------|--------------------------|
| calibrate.py | Scripts to drive a donkey 2 car. |
| config.py    | CAR CONFIG |
| manage.py    | Scripts to drive a donkey 2 car. |
| myconfig.py  | My CAR CONFIG |
| train.py     | Scripts to train a keras model using tensorflow. |
